<p id="notice"><%= notice %></p>
<h1><%= best_in_place @section, :name, :type => :input %></h1>

<p>
  <b>所属章节:</b>
  <%= link_to @section.lesson.name, lesson_path(@section.lesson) %>
</p>

<p>
  <b>章节重点笔记:</b>
  <%= best_in_place @section, :description, :type => :textarea %>
  
<script>
function showEditForm()
{
  document.getElementById("editForm").style.display="block"
  document.getElementById("typeSelect").style.display="none"
  document.getElementById("newQuizActivityForm").style.display="none"
  document.getElementById("newVideoActivityForm").style.display="none"
  document.getElementById("newGalleryActivityForm").style.display="none"
  document.getElementById("newTextActivityForm").style.display="none"
  document.getElementById("newAudioActivityForm").style.display="none"
  document.getElementById("newHtmlActivityForm").style.display="none"
}

function showTypeSelect()
{
  document.getElementById("typeSelect").style.display="block"
  document.getElementById("editForm").style.display="none"
}

function switchView(type)
{
  document.getElementById("newQuizActivityForm").style.display="none"
  document.getElementById("newVideoActivityForm").style.display="none"
  document.getElementById("newGalleryActivityForm").style.display="none"
  document.getElementById("newTextActivityForm").style.display="none"
  document.getElementById("newAudioActivityForm").style.display="none"
  document.getElementById("newHtmlActivityForm").style.display="none"
  if(type==1)
    document.getElementById("newTextActivityForm").style.display="block"
  else if(type==2)
    document.getElementById("newQuizActivityForm").style.display="block"
  else if(type==3)
    document.getElementById("newVideoActivityForm").style.display="block"
  else if(type==4)
    document.getElementById("newGalleryActivityForm").style.display="block"
  else if(type==5)
    document.getElementById("newAudioActivityForm").style.display="block"
  else if(type==6)
    document.getElementById("newHtmlActivityForm").style.display="block"

}

function showNewActivityForm()
{
  document.getElementById("newActivityForm").style.display="block"
  
}
</script>
<p>
  <b>环节名称:</b>
  <%= @section.name %>
</p>

<p>
  <b>属于课程:</b>
  <%= @section.lesson_id %>
</p>

<p>
  <b>描述:</b>
  <%= @section.description %>
</p>

<h3>------------------环节列表------------------</h3>
<table>
  <tr>
    <th>环节ID</th>
    <th>排序</th>
    <th>类型</th>
    <th>名称</th>
    <th>附件</th>
    <th>其它</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

<% @activities.each do |activity| %>
  <tr>
      <td><%= activity.id %></td>
    <% if(activity.tipe.eql?("video")) %>
      <td><%= activity.order %></td>
      <td>视频</td>
      <td><%= activity.video_activity.name %></td>
      <td><% if activity.video_activity.vid_file %>
      		<%= (link_to "#{activity.video_activity.vid_file_file_name}", activity.video_activity.vid_file.url(:original, false)) %>
      	  <% else %>
      	    "无"
      	  <% end %>
      </td>
      <td>描述：<%= activity.video_activity.description %></td>
    <% elsif(activity.tipe.eql?("text")) %>
      <td><%= activity.order %></td>
      <td>文本</td>
      <td><%= activity.text_activity.name %></td>
      <td><% if activity.text_activity.txt_file %>
      		<%= (link_to "#{activity.text_activity.txt_file_file_name}", activity.text_activity.txt_file.url(:original, false)) %>
      	  <% else %>
      	    <%= "无"%>
      	  <% end %>
      </td>
      <td>描述：<%= activity.text_activity.description %></td>
    <% elsif(activity.tipe.eql?("quiz"))%>
      <td><%= activity.order %></td>
      <td>测试</td>
      <td><%= activity.quiz_activity.name %></td>
	  <td>(暂无)</td>
      <td>长度：<%= activity.quiz_activity.size %></td>
    <% elsif(activity.tipe.eql?("gallery"))%>
      <td><%= activity.order %></td>
      <td>图片（集）</td>
      <td><%= activity.gallery_activity.name %></td>
      <td><% if activity.gallery_activity.img_files %>
            <%= (link_to "#{activity.gallery_activity.img_files_file_name}", activity.gallery_activity.img_files.url(:original, false)) %>
      	  <% else %>
      	    <%= "无"%>
      	  <% end %>
      </td>
      <td>描述：<%= activity.gallery_activity.description %></td>
    <% elsif(activity.tipe.eql?("audio"))%>
      <td><%= activity.order %></td>
      <td>音频</td>
      <td><%= activity.audio_activity.name %></td>
      <td><% if activity.audio_activity.aud_file %>
      		<%= (link_to "#{activity.audio_activity.aud_file_file_name}", activity.audio_activity.aud_file.url(:original, false)) %>
      	  <% else %>
      	    <%= "无"%>
      	  <% end %>
      </td>
      <td>描述：<%= activity.audio_activity.description %></td>
    <% elsif(activity.tipe.eql?("html"))%>
      <td><%= activity.order %></td>
      <td>HTML</td>
      <td><%= activity.html_activity.name %></td>
      <td><% if activity.html_activity.html_file %>
      		<%= (link_to "#{activity.html_activity.html_file_file_name}", activity.html_activity.html_file.url(:original, false)) %>
      	  <% else %>
      	    <%= "无"%>
      	  <% end %>
      </td>
      <td>描述：<%= activity.html_activity.description %></td>
    <% end %>
    <% if activity.tipe.eql?("video")%>
      <td><%= link_to 'Show', :url => {:controller => :video_activities, :section_id => @section.id } %></td>
      <td><%= link_to 'Edit', :url => {:controller => :video_activities, :action => :edit, :section_id => @section.id } %></td>
    <% elsif activity.tipe.eql?("text")%>
      <td><%= link_to 'Show', activity.text_activity %></td>
      <td><%= link_to 'Edit', edit_text_activity_path(activity.text_activity) %></td>
    <% elsif activity.tipe.eql?("quiz")%>
      <td><%= link_to 'Show', activity.quiz_activity %></td>
      <td><%= link_to 'Edit', edit_quiz_activity_path(activity.quiz_activity) %></td>
    <% elsif activity.tipe.eql?("gallery")%>
      <td><%= link_to 'Show', activity.gallery_activity %></td>
      <td><%= link_to 'Edit', edit_gallery_activity_path(activity.gallery_activity) %></td>
    <% elsif activity.tipe.eql?("html")%>
      <td><%= link_to 'Show', activity.html_activity %></td>
      <td><%= link_to 'Edit', edit_html_activity_path(activity.html_activity) %></td>
    <% elsif activity.tipe.eql?("audio")%>
      <td><%= link_to 'Show', activity.audio_activity %></td>
      <td><%= link_to 'Edit', edit_audio_activity_path(activity.audio_activity) %></td>
    <% end %>
    <td><%= link_to 'Destroy', activity, confirm: 'Are you sure?', method: :delete %></td>
  </tr>
<% end %>
</table>
</br>
<button onclick="showEditForm()">编辑小节属性</button>
<button onclick="showTypeSelect()">添加新的环节</button>

<div id="editForm" style="display:none">
<%= render 'form' %>
</div>


<div id="typeSelect" style="display:none">
  <p>请选择上传的Activity的种类：</p>
  <input type="radio" name="typeSelect" id="ts1" value="1" onclick="switchView(1)"/>
  <label for="ts1"> 文本 </label>
  <input type="radio" name="typeSelect" id="ts2" value="2" onclick="switchView(2)"/>
  <label for="ts2"> 习题 </label>
  <input type="radio" name="typeSelect" id="ts3" value="3" onclick="switchView(3)"/>
  <label for="ts3"> 视频 </label>
  <input type="radio" name="typeSelect" id="ts4" value="4" onclick="switchView(4)"/>
  <label for="ts4"> 图片 </label>
  <input type="radio" name="typeSelect" id="ts5" value="5" onclick="switchView(5)"/>
  <label for="ts5"> 音频 </label>
  <input type="radio" name="typeSelect" id="ts6" value="6" onclick="switchView(6)"/>
  <label for="ts6"> HTML </label>
</div>

<div id="newVideoActivityForm" style="display:none">
<% @video_activity = VideoActivity.new %>

<%= form_for @video_activity, :url => {:controller => :video_activities, :action => :create, :section_id => @section.id, :order => @activities.size } do |f| %>
  <% if @video_activity.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@video_activity.errors.count, "error") %> prohibited this video_activity from being saved:</h2>

      <ul>
      <% @video_activity.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  
  <div class="field">
    <p>名称:</p>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <p>排序:</p>
    <%= f.number_field :order%>
  </div>
  <div class="field">
    <p>提供方:</p>
    <%= f.number_field :provider_id %>
  </div>
  <div class="field">
	视频附件:
	<%if @video_activity.vid_file? %>
	<%=	"(已上传:#{@video_activity.vid_file_file_name})"%>
	<%else%>
	<%=	"(未上传)"%>
	<%end%>
	<br />
    <%= f.file_field :vid_file %>
  </div>
  <div class="field">
    <p>重点笔记:</p>
    <%= f.text_area :notes %>
  </div>
  <div class="field">
    <p>时长:（秒）</p>
    <%= f.number_field :duration %>
  </div>
  <div class="field">
    <p>描述:</p>
    <%= f.text_area :description %>
  </div>
  <div class="actions">
    <%= f.submit "提交"%>
  </div>
<% end %>
</div>

<div id="newTextActivityForm" style="display:none">
<% @text_activity = TextActivity.new %>
<%= form_for @text_activity, :url => {:controller => :text_activities, :action => :create, :section_id => @section.id, :order => @activities.size } do |f| %>
  <% if @text_activity.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@text_activity.errors.count, "error") %> prohibited this text_activity from being saved:</h2>

      <ul>
      <% @text_activity.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <p>名称:</p>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <p>排序:</p>
    <%= f.number_field :order%>
  </div>
  <div class="field">
    <p>提供方:</p>
    <%= f.number_field :provider_id %>
  </div>
  <div class="field">
	附件:
	<%if @text_activity.txt_file? %>
	<%=	"(已上传:#{@text_activity.txt_file_file_name})"%>
	<%else%>
	<%=	"(未上传)"%>
	<%end%>
	<br />
    <%= f.file_field :txt_file %>
  </div>
  <div class="field">
    <p>描述:</p>
    <%= f.text_area :description %>
  </div>
  <div class="actions">
    <%= f.submit "提交"%>
  </div>
<% end %>
</div>

<div id="newGalleryActivityForm" style="display:none">
<% @gallery_activity = GalleryActivity.new %>
<%= form_for @gallery_activity, :url => {:controller => :gallery_activities, :action => :create, :section_id => @section.id, :order => @activities.size } do |f| %>
  <% if @gallery_activity.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@gallery_activity.errors.count, "error") %> prohibited this gallery_activity from being saved:</h2>

      <ul>
      <% @gallery_activity.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <p>名称:</p>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <p>排序:</p>
    <%= f.number_field :order%>
  </div>
  <div class="field">
    <p>提供方:</p>
    <%= f.number_field :provider_id %>
  </div>
  <div class="field">
	图片集附件:
	<%if @gallery_activity.img_files? %>
	<%=	"(已上传:#{@gallery_activity.img_files_file_name})"%>
	<%else%>
	<%=	"(未上传)"%>
	<%end%>
	<br />
    <%= f.file_field :img_files %>
  </div>
  <div class="field">
    <p>描述:</p>
    <%= f.text_area :description %>
  </div>
  <div class="field">
    <p>重点笔记:</p>
    <%= f.text_area :notes %>
  </div>
  <div class="actions">
    <%= f.submit "提交"%>
  </div>
<% end %>
</div>

<div id="newQuizActivityForm" style="display:none">
<% @quiz_activity = QuizActivity.new %>
<%= form_for @quiz_activity, :url => {:controller => :quiz_activities, :action => :create, :section_id => @section.id, :order => @activities.size } do |f| %>
  <% if @quiz_activity.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@quiz_activity.errors.count, "error") %> prohibited this quiz_activity from being saved:</h2>

      <ul>
      <% @quiz_activity.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <p>名称:</p>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <p>排序:</p>
    <%= f.number_field :order%>
  </div>
  <div class="field">
    <p>提供方:</p>
    <%= f.number_field :provider_id %>
  </div>
  <div class="field">
    <p>附件:</p>
    <%= f.text_field :file_path %>
  </div>
  <div class="field">
    <p>习题数量:</p>
    <%= f.number_field :size %>
  </div>
  <div class="field">
    <p>难度指数 :</p>
    <%= f.number_field :difficulty %>
  </div>
  <div class="actions">
    <%= f.submit "提交"%>
  </div>
<% end %>
</div>

<div id="newAudioActivityForm" style="display:none">
<% @audio_activity = AudioActivity.new %>
<%= form_for @audio_activity, :url => {:controller => :audio_activities, :action => :create, :section_id => @section.id, :order => @activities.size } do |f| %>
  <% if @audio_activity.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@audio_activity.errors.count, "error") %> prohibited this audio_activity from being saved:</h2>

      <ul>
      <% @audio_activity.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <p>名称:</p>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <p>排序:</p>
    <%= f.number_field :order%>
  </div>
  <div class="field">
    <p>提供方:</p>
    <%= f.number_field :provider_id %>
  </div>
  <div class="field">
	音频附件:
	<%if @audio_activity.aud_file? %>
	<%=	"(已上传:#{@audio_activity.aud_file_file_name})"%>
	<%else%>
	<%=	"(未上传)"%>
	<%end%>
	<br />
    <%= f.file_field :aud_file %>
  </div>
  <div class="field">
    <p>注解笔记:</p>
    <%= f.text_area :notes %>
  </div>
  <div class="field">
    <p>时长:（秒）</p>
    <%= f.number_field :duration %>
  </div>
  <div class="field">
    <p>描述:</p>
    <%= f.text_area :description %>
  </div>
  <div class="actions">
    <%= f.submit "提交"%>
  </div>
<% end %>
</div>

<div id="newHtmlActivityForm" style="display:none">
<% @html_activity = HtmlActivity.new %>
<%= form_for @html_activity, :url => {:controller => :html_activities, :action => :create, :section_id => @section.id, :order => @activities.size } do |f| %>
  <% if @html_activity.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@html_activity.errors.count, "error") %> prohibited this html_activity from being saved:</h2>

      <ul>
      <% @html_activity.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <p>名称:</p>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <p>排序:</p>
    <%= f.number_field :order%>
  </div>
  <div class="field">
    <p>提供方:</p>
    <%= f.number_field :provider_id %>
  </div>
  <div class="field">
	附件:
	<%if @html_activity.html_file? %>
	<%=	"(已上传:#{@html_activity.html_file_file_name})"%>
	<%else%>
	<%=	"(未上传)"%>
	<%end%>
	<br />
    <%= f.file_field :html_file %>
  </div>
  <div class="field">
    <p>描述:</p>
    <%= f.text_area :description %>
  </div>
  <div class="actions">
    <%= f.submit "提交"%>
  </div>
<% end %>
</div>